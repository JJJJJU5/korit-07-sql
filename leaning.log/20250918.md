# CUD 관련 수업

1. Database 생성

```sql
create database 데이터베이스명

create database kor_it
```

2. 특정 DB의 사용

```sql
use 데이터베이스명

use kor_it;
```

3. 테이블 생성

```sql
create table 테이블명(
  컬럼1 속성1, 속성2, ...,
  컬럼2 속성a, 속성b, ...,
);
CREATE TABLE students (
	student_id INT AUTO_INCREMENT PRIMARY key,
	student_name VARCHAR(100) NOT NULL,
	enrollment_date DATE NOT null
);
```

현재까지 수업에서 students / student2 라고 하는 두 개의 테이블을 생성했다. 그런데 students에는 없고
students2 에는 있는 컬럼이 있다. email 컬럼 이다 그러면 이미 생성된 테이블에 대고 컬럼을 추가해야 한다.

- 컬럼 추가 SQL문

```sql
alter table 테이블명 ADD column 컬럼명 자료형 조건;
alter table student add column student_email. varchar(100) not null;
```

- 컬럼 삭제 sql문

```sql
alter table 테이블명 drop colunm 컬럼명;
alter table students2 drop column email;
```

- 해당 컬럼의 모든 데이터가 영구적으로 삭제된다. 되돌릴 수 없기 때문에 백업 등 사전 준비가 필요하다.

- 컬럼 수정 sql문

```sql
alter table 테이블명 change column 기존컬럼명 새컬럼명 자료형, 조건을 전부 새로 세팅할 때 사용
```

change를 쓸 경우 컬럼명만 바꾸더라도 자료형과 조건을 전부 다 명시해야 한다.

```sql
alter table students2 change column email student2_email varchar(100) not null
```

2. RENAME : 컬럼의 이름만 변경하고 기존 자료형과 조건은 유지됨, DB에 따라 지원이 되는 것도
   아닌 것도 있음.

```sql
alter table students2 RENAME column 기존 컬럼명 to 새컬럼명:
alter table students2 renmae column email to student2_email;
```

enrollment_date를 삭제하고, student_enrollment_date를 추가

```sql
ALTER TABLE students DROP enrollment_date
alter table students add column student_enrollment_date1 varchar(100) not null
```

- student 테이블에 데이터 삽입 SQL문

```sql
insert into 테이블명 (컬럼명1, 컬럼명2, ...컬럼명 n) values (데이터 a1, 데이터a 2, ..., 데이터an),
(데이터 b1, 데이터 b2, ..., 데이터 bn);
INSERT INTO students (student_name, student_email, student_enrollment_date)
VALUES
('김 일' , 'kim1@test.com' , '2015-09-18'),
('김 이' , 'kim2@test.com' , '2015-09-12')
```

이상의 코드에서 주목하셔야 하는 부분은 student_id 컬럼에 값을 insert 하지 않았다는 점이다.
이유는 table 생성 시(즉, DDL을 사용했을 때), AUTO_increment를 적용했기 때문이다.

그리고 전체 컬럼에 차례대로 데이터를 입력한다고 가정하면(컬럼명1, 컬럼명2, ..., 컬럼명n) 부분이
없어도 된다. 다만 실무 상에서는 어느 컬럼에 어떤 데이터를 넣었는지 명확하게 하기 위해 항상 명시해주는 편이다.

- 특정 데이터 수정 SQL문

```sql
update 테이블명
set 컬럼명 = 바꿀데이터값
where 컬럼명  = 검색가능한데이터값

update students
set student_name = '김사백오십'
where student_id = 1
```

- 특정 데이터 삭제 sql문

```sql
delete form 테이블명
where 조건;
```

지시 사항

1. 김삼 / kim3@test.com / 2025-02-01 데이터를 추가하시오.
2. 김사 / kim4@test.com / 2025-03-01 데이터를 추가하시오.

```sql
INSERT INTO students(student_name , student_email,student_enrollment_date)
VALUES
('김삼','kim3@test.com','2025-02-01')
('김사','kim4@test.com','2024-03-01')
```

3. 김삼 데이터를 삭제하시오.

```sql
DELETE FROM students
WHERE student_name = '김삼'
```

4. 김사 이름을 지니고 있는 데이터의 student_enrollment_date를 2024-04-04로 수정하시오.
   5 select 문을 통해 김사 데이터만 콘솔에 출력하시오.

```sql
UPDATE students
SET student_enrollment_date = '2024-04-04'
WHERE student_name = '김사'
SELECT *
WHERE student_name = '김사'
```

1. 지시 사항 - 다음을 만족하는 테이블을 생성하시오 (sql/ gui 뭐든)
   테이블명 : instructor
   컬럼명 :
1. instructor_id / INT / PK / auto_increment 적용
1. name / varchar(100) / not null
1. email / varchar(100) / not null
1. hire_date / date / not null

```sql
create table instructor (instructor_id int primary Key auto_increment,
name varchar(100) not null
email varchar(100) not null
hire_date date not null)
```

2. instructor 테이블에 다음과 같은 정보를 추가하시오.
   이일 / 21@test.com / 2025-09-18
   이이 / 22@test.com / 2022-09-18
   이삼 / 23@test.com / 2023-09-18

```sql
INSERT INTO instructor
(NAME,email,hire_date)
VALUES
('이일','21@test.com','2025-09-18'),
('이이','22@test.com','2022-09-18'),
('이삼','23@test.com','2023-09-18');
```

과목 테이블 courses를 생성
course_id / INT / primary key
course_name / varchar(100)
instructor_id / int / Foreign Key
start_date / date
end_date / date

students / instructor 간의 관계 테이블을 하나 만든다.
테이블 명 : student_courses

```sql
CREATE TABLE courses (course_id INT PRIMARY KEY ,
course_name VARCHAR(100) NOT NULL,
instructor_id INT NOT NULL,
start_date DATE NOT NULL,
end_date DATE NOT NULL,
FOREIGN KEY (instructor_id) REFERENCES instructor(instructor_id)
);
```

students / courses 간의 관계 테이블을 하나 만든다.
테이블명 : student_courses

student_id / int / pk, fk
coures_id / int / pk, fk

- student*id와 coures_id의 값을 조합하여 *복합 기본 키 (Composite primary Key)\_ 로 설정한다.
- 일반 pk처럼 테이블의 각 행이 고유하도록 보장하며, 같은 수강생이 동일한 과목이 중복해서 등록할 수가 없다.
  예를 들어 student_id가 1인 학생이 2에 해당하는 python 과목을 수강한다고 가정했을 때 student_courses 테이블의 pk는 12가 된다.
  추후 1 학생이 다시 2를 들으려고하면 pk가 12로 중복될 것이기 때문에 고유값을 침해하여 수강 불가가 뜨게 된다.

출석 현황 테이블 생성(attendence)
테이블 명 : attendence
attendence_id / int / pk
student_id / int / fk
course_id / int / fk
date / date
status / varchar(10) / 예시 출석 결석 etc

```sql
create table attendence (
  attendence_id int auto_increment primary key,
  student_id int not null,
  course_id int not null,
  date date not null,
  status varchar(10) not null,
  foreign key (student_id) references students(student_id),
  foreign key (course_id) references courses(course_id)
)
```

예제 데이터 삽입

```sql
== attendence
insert into attendence (student_id , course_id , date , status) values
(1,1,'2025-09-18','출'),
(2,1,'2025-09-18','결'),
(4,1,'2025-09-18','출'),
(1,2,'2025-09-19','출'),
(2,2,'2025-09-19','출'),
(4,2,'2025-09-19','결');

== courses
insert into courses (course_name , instructor_id, start_date, end_date) values
('Java',1,'2025-09-01','2025-09-30'),
('python',2,'2025-09-02','2025-09-29');

== instructor
insert into instructor (instructor_name, email , hire_date) vlaues
('김선생' , 'kimt@test.com','2025-07-01')
('이선생' , 'leet@test.com','2025-02-01')

== student_courses
insert into student_courses(student_id,course_id) values
(1,1),
(2,1),
(4,1),
(1,2),
(4,2),
```

이전 수행에서 students에서 student_id = 3을 삭제했기 때문에 오류가 발생했다. 그래서 전체적으로 3으로 적힌 부분을 4로 수정하여 처리

지시 사항 : 1
수강생 목록 및 과목 조회

1. students / students_courses / courses 테이블을 결합하여, 각 학생의 일므과 그 학생이 수강하는 모든 과목명을 조회하도록 한다. 결과는 이름 순서로

```sql
SELECT s.student_name ,c.course_name ,s.student_email
FROM students s
JOIN student_courses sc
ON s.student_id = sc.student_id
JOIN courses c
ON sc.course_id = c.course_id
ORDER BY s.student_name ASC;
```

2. 김사백오십 학생의 이름과 이메일 그리고 수강 과목을 출력하시오.

```sql
SELECT s.student_name ,c.course_name ,s.student_email
FROM students s
JOIN student_courses sc
ON s.student_id = sc.student_id
JOIN courses c
ON sc.course_id = c.course_id
WHERE s.student_name = '김사백오십'
ORDER BY s.student_name ASC;
```

3. 이일 강사의 교수 과목과 수강생 수를 출력하시오.

정답

```sql
SELECT c.course_name,i.`name`, COUNT(DISTINCT sc.student_id) AS studentCnt
FROM instructor i
JOIN courses c
ON i.instructor_id = c.instructor_id
JOIN student_courses sc
ON c.course_id = sc.course_id
```
